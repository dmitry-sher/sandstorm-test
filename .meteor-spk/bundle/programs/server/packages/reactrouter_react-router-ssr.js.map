{"version":3,"sources":["meteor://ðŸ’»app/packages/reactrouter:react-router-ssr/lib/react-router-ssr.js","meteor://ðŸ’»app/packages/reactrouter:react-router-ssr/lib/client.jsx","meteor://ðŸ’»app/packages/reactrouter:react-router-ssr/lib/server.jsx","meteor://ðŸ’»app/packages/reactrouter:react-router-ssr/lib/ssr_context.js","meteor://ðŸ’»app/packages/reactrouter:react-router-ssr/lib/ssr_data.js"],"names":["checkNpmVersions","module","watch","require","v","Meteor","isClient","ReactRouterSSR","default","export","React","ReactDOM","Router","browserHistory","Run","routes","clientOptions","history","historyHook","startup","rootElementName","rootElement","rootElementType","attributes","rootElementAttributes","Array","document","getElementById","createElement","id","i","length","setAttribute","body","appendChild","rehydrateHook","InjectData","getData","rehydratedData","data","JSON","parse","undefined","appGenerator","addProps","props","app","wrapperHook","renderHook","render","collectorEl","styleCollectorId","parentNode","removeChild","exportDefault","ReactRouterMatch","RouterContext","createMemoryHistory","match","SsrContext","patchSubscribeData","ReactDOMServer","cookieParser","Cheerio","merge","IsAppUrl","req","url","RoutePolicy","classify","webpackStats","ssrContext","EnvironmentVariable","inSubscription","LoadWebpackStats","stats","serverOptions","bindEnvironment","WebApp","rawConnectHandlers","use","connectHandlers","res","next","global","__CHUNK_COLLECTOR__","loginToken","cookies","headers","context","FastRender","_Context","frContext","withValue","location","err","redirectLocation","renderProps","writeHead","write","messages","end","Location","pathname","search","sendSSRHtml","generateSSRData","css","html","patchResWrite","originalWrite","indexOf","dontMoveScripts","moveScripts","replace","htmlHook","addAssetsChunks","call","chunkNames","assetsByChunkName","publicPath","common","chunkSrc","frData","addData","collectionData","preRender","__STYLE_COLLECTOR_MODULES__","__STYLE_COLLECTOR__","dataLoader","disableSSR","renderToString","loadingScreen","dehydrateHook","pushData","stringify","postRender","get","console","error","Date","stack","fetchComponentData","componentsWithFetch","components","filter","component","fetchData","Package","promise","promises","fetchDataHook","Promise","awaitAll","$","load","decodeEntities","heads","append","_collections","getCollection","collName","collection","minimongo","LocalCollection","addSubscription","name","params","fastRenderContext","Error","subscribe","_","each","collDataCollection","collectionName","forEach","collData","item","existingDoc","findOne","_id","newDoc","update","$set","insert","originalSubscribe","pubName","prototype","slice","arguments","apply","ready","Mongo","mongo","originalFind","Collection","find","selector","options","_name","_transform","transform","cursor","limit","fetch","originalAutorun","Tracker","autorun","fn","c","firstRun","stop","methodName","original","args","response","loggingIn"],"mappings":"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","file":"/packages/reactrouter_react-router-ssr.js","sourcesContent":["import { checkNpmVersions } from 'meteor/tmeasday:check-npm-versions';\ncheckNpmVersions({\n  'react': '15.x',\n  'react-dom': '15.x',\n  'react-router': '3.x'\n}, 'reactrouter:react-router-ssr');\n\nif (Meteor.isClient) {\n  ReactRouterSSR = require('./client.jsx').default;\n} else {\n  ReactRouterSSR = require('./server.jsx').default;\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Router, browserHistory } from 'react-router';\n\nconst ReactRouterSSR = {\n  Run(routes, clientOptions) {\n    if (!clientOptions) {\n      clientOptions = {};\n    }\n\n    let history = browserHistory;\n\n    if(typeof clientOptions.historyHook === 'function') {\n      history = clientOptions.historyHook(history);\n    }\n\n    Meteor.startup(function() {\n      const rootElementName = clientOptions.rootElement || 'react-app';\n      const rootElementType = clientOptions.rootElementType || 'div';\n      const attributes = clientOptions.rootElementAttributes instanceof Array ? clientOptions.rootElementAttributes : [];\n      let rootElement = document.getElementById(rootElementName);\n\n      // In case the root element doesn't exist, let's create it\n      if (!rootElement) {\n        rootElement = document.createElement(rootElementType);\n        rootElement.id = rootElementName;\n\n        // check if a 2-dimensional array was passed... if not, be nice and handle it anyway\n        if(attributes[0] instanceof Array) {\n          // set attributes\n          for(var i = 0; i < attributes.length; i++) {\n            rootElement.setAttribute(attributes[i][0], attributes[i][1]);\n          }\n        } else if (attributes.length > 0){\n          rootElement.setAttribute(attributes[0], attributes[1]);\n        }\n\n        document.body.appendChild(rootElement);\n      }\n\n      // Rehydrate data client side, if desired.\n      if(typeof clientOptions.rehydrateHook === 'function') {\n        InjectData.getData('dehydrated-initial-data', data => {\n          const rehydratedData = data ? JSON.parse(data) : undefined;\n          clientOptions.rehydrateHook(rehydratedData);\n        });\n      }\n\n      let appGenerator = (addProps) => (\n        <Router\n          history={history}\n          children={routes}\n          {...clientOptions.props}\n          {...addProps } />\n      );\n\n      let app = <Router\n        history={history}\n        children={routes}\n        {...clientOptions.props} />;\n    \n      if (typeof clientOptions.wrapperHook === 'function') {\n        app = clientOptions.wrapperHook(appGenerator);\n      }\n\n      if (typeof clientOptions.renderHook === 'function') {\n        clientOptions.renderHook(app, rootElement);\n      } else {\n        ReactDOM.render(app, rootElement);\n      }\n\n      let collectorEl = document.getElementById(clientOptions.styleCollectorId || 'css-style-collector-data')\n\n      if (collectorEl) {\n        collectorEl.parentNode.removeChild(collectorEl);\n      }\n    });\n  }\n};\n\nexport { ReactRouterSSR };\nexport default ReactRouterSSR;\n","import React from 'react';\n\nimport {\n  match as ReactRouterMatch,\n  RouterContext,\n  createMemoryHistory\n} from 'react-router';\n\nimport SsrContext from './ssr_context';\nimport patchSubscribeData from './ssr_data';\n\nimport ReactDOMServer from 'react-dom/server';\nimport cookieParser from 'cookie-parser';\nimport Cheerio from 'cheerio';\nimport merge from 'lodash/merge';\n\nfunction IsAppUrl(req) {\n  var url = req.url;\n  if(url === '/favicon.ico' || url === '/robots.txt') {\n    return false;\n  }\n\n  if(url === '/app.manifest') {\n    return false;\n  }\n\n  // Avoid serving app HTML for declared routes such as /sockjs/.\n  if(RoutePolicy.classify(url)) {\n    return false;\n  }\n  return true;\n}\n\nlet webpackStats;\n\nconst ReactRouterSSR = {};\nexport default ReactRouterSSR;\n\n// creating some EnvironmentVariables that will be used later on\nReactRouterSSR.ssrContext = new Meteor.EnvironmentVariable();\nReactRouterSSR.inSubscription = new Meteor.EnvironmentVariable(); // <-- needed in ssr_data.js\n\nReactRouterSSR.LoadWebpackStats = function(stats) {\n  webpackStats = stats;\n};\n\n// this line just patches Subscribe and find mechanisms\npatchSubscribeData(ReactRouterSSR);\n\nReactRouterSSR.Run = function(routes, clientOptions, serverOptions) {\n\n  if (!clientOptions) {\n    clientOptions = {};\n  }\n\n  if (!serverOptions) {\n    serverOptions = {};\n  }\n\n  if (!serverOptions.webpackStats) {\n    serverOptions.webpackStats = webpackStats;\n  }\n\n  Meteor.bindEnvironment(function() {\n    WebApp.rawConnectHandlers.use(cookieParser());\n\n    WebApp.connectHandlers.use(Meteor.bindEnvironment(function(req, res, next) {\n      if (!IsAppUrl(req)) {\n        next();\n        return;\n      }\n\n      global.__CHUNK_COLLECTOR__ = [];\n\n      var loginToken = req.cookies['meteor_login_token'];\n      var headers = req.headers;\n      var context = new FastRender._Context(loginToken, { headers });\n\n\n      FastRender.frContext.withValue(context, function() {\n        let history = createMemoryHistory(req.url);\n\n        if (typeof serverOptions.historyHook === 'function') {\n          history = serverOptions.historyHook(history);\n        }\n\n        ReactRouterMatch({ history, routes, location: req.url }, Meteor.bindEnvironment((err, redirectLocation, renderProps) => {\n          if (err) {\n            res.writeHead(500);\n            res.write(err.messages);\n            res.end();\n          } else if (redirectLocation) {\n            res.writeHead(302, { Location: redirectLocation.pathname + redirectLocation.search });\n            res.end();\n          } else if (renderProps) {\n            sendSSRHtml(clientOptions, serverOptions, req, res, next, renderProps);\n          } else {\n            res.writeHead(404);\n            res.write('Not found');\n            res.end();\n          }\n        }));\n      });\n    }));\n  })();\n};\n\nfunction sendSSRHtml(clientOptions, serverOptions, req, res, next, renderProps) {\n  const { css, html } = generateSSRData(clientOptions, serverOptions, req, res, renderProps);\n  res.write = patchResWrite(clientOptions, serverOptions, res.write, css, html);\n\n  next();\n}\n\nfunction patchResWrite(clientOptions, serverOptions, originalWrite, css, html) {\n  return function(data) {\n    if(typeof data === 'string' && data.indexOf('<!DOCTYPE html>') === 0) {\n      if (!serverOptions.dontMoveScripts) {\n        data = moveScripts(data);\n      }\n\n      if (css) {\n        data = data.replace('</head>', '<style id=\"' + (clientOptions.styleCollectorId || 'css-style-collector-data') + '\">' + css + '</style></head>');\n      }\n\n      if (typeof serverOptions.htmlHook === 'function') {\n        data = serverOptions.htmlHook(data);\n      }\n\n      let rootElementAttributes = '';\n      const attributes = clientOptions.rootElementAttributes instanceof Array ? clientOptions.rootElementAttributes : [];\n      if(attributes[0] instanceof Array) {\n        for(var i = 0; i < attributes.length; i++) {\n          rootElementAttributes = rootElementAttributes + ' ' + attributes[i][0] + '=\"' + attributes[i][1] + '\"';\n        }\n      } else if (attributes.length > 0){\n        rootElementAttributes = ' ' + attributes[0] + '=\"' + attributes[1] + '\"';\n      }\n\n      data = data.replace('<body>', '<body><' + (clientOptions.rootElementType || 'div') + ' id=\"' + (clientOptions.rootElement || 'react-app') + '\"' + rootElementAttributes + '>' + html + '</' + (clientOptions.rootElementType || 'div') + '>');\n\n      if (typeof serverOptions.webpackStats !== 'undefined') {\n        data = addAssetsChunks(serverOptions, data);\n      }\n    }\n\n    originalWrite.call(this, data);\n  };\n}\n\nfunction addAssetsChunks(serverOptions, data) {\n  const chunkNames = serverOptions.webpackStats.assetsByChunkName;\n  const publicPath = serverOptions.webpackStats.publicPath;\n\n  if (typeof chunkNames.common !== 'undefined') {\n    var chunkSrc = (typeof chunkNames.common === 'string')?\n      chunkNames.common :\n      chunkNames.common[0];\n\n    data = data.replace('<head>', '<head><script type=\"text/javascript\" src=\"' + publicPath + chunkSrc + '\"></script>');\n  }\n\n  for (var i = 0; i < global.__CHUNK_COLLECTOR__.length; ++i) {\n    if (typeof chunkNames[global.__CHUNK_COLLECTOR__[i]] !== 'undefined') {\n      chunkSrc = (typeof chunkNames[global.__CHUNK_COLLECTOR__[i]] === 'string')?\n        chunkNames[global.__CHUNK_COLLECTOR__[i]] :\n        chunkNames[global.__CHUNK_COLLECTOR__[i]][0];\n\n      data = data.replace('</head>', '<script type=\"text/javascript\" src=\"' + publicPath + chunkSrc + '\"></script></head>');\n    }\n  }\n\n  return data;\n}\n\nfunction generateSSRData(clientOptions, serverOptions, req, res, renderProps) {\n  let html, css;\n\n  // we're stealing all the code from FlowRouter SSR\n  // https://github.com/kadirahq/flow-router/blob/ssr/server/route.js#L61\n  const ssrContext = new SsrContext();\n\n  ReactRouterSSR.ssrContext.withValue(ssrContext, () => {\n    try {\n      const frData = InjectData.getData(res, 'fast-render-data');\n      if (frData) {\n        ssrContext.addData(frData.collectionData);\n      }\n      if (serverOptions.preRender) {\n        serverOptions.preRender(req, res);\n      }\n\n      // Uncomment these two lines if you want to easily trigger\n      // multiple client requests from different browsers at the same time\n\n      // console.log('sarted sleeping');\n      // Meteor._sleepForMs(5000);\n      // console.log('ended sleeping');\n\n      global.__STYLE_COLLECTOR_MODULES__ = [];\n      global.__STYLE_COLLECTOR__ = '';\n\n      renderProps = {\n        ...renderProps,\n        ...serverOptions.props\n      };\n\n      // Instead of fetchComponentData we need to fetch from Apollo Data\n      //fetchComponentData(serverOptions, renderProps);\n      let appGenerator = (addProps) => <RouterContext {...renderProps} {...addProps} />;\n\n      let app = <RouterContext {...renderProps} />;\n      if (typeof clientOptions.wrapperHook === 'function') {\n        app = clientOptions.wrapperHook(appGenerator);\n      }\n\n      // Adding new parameter dataLoader for loading data through Apollo\n      if (serverOptions.dataLoader) {\n        serverOptions.dataLoader(req, res, app);\n      }\n\n      if (!serverOptions.disableSSR){\n        html = ReactDOMServer.renderToString(app);\n      } else if (serverOptions.loadingScreen){\n        html = serverOptions.loadingScreen;\n      }\n\n      css = global.__STYLE_COLLECTOR__;\n\n      if (typeof serverOptions.dehydrateHook === 'function') {\n        InjectData.pushData(res, 'dehydrated-initial-data', JSON.stringify(serverOptions.dehydrateHook()));\n      }\n\n      if (serverOptions.postRender) {\n        serverOptions.postRender(req, res);\n      }\n\n      // I'm pretty sure this could be avoided in a more elegant way?\n      const data = FastRender.frContext.get().getData();\n      InjectData.pushData(res, 'fast-render-data', merge(data, frData));\n    }\n    catch(err) {\n      console.error(new Date(), 'error while server-rendering', err.stack);\n    }\n  });\n  return { html, css };\n}\n\nfunction fetchComponentData(serverOptions, renderProps) {\n  const componentsWithFetch = renderProps.components\n    .filter(component => !!component)\n    .filter(component => component.fetchData);\n\n  if (!componentsWithFetch.length) {\n    return;\n  }\n\n  if (!Package.promise) {\n    console.error(\"react-router-ssr: Support for fetchData() static methods on route components requires the 'promise' package.\");\n    return;\n  }\n\n  const promises = serverOptions.fetchDataHook(componentsWithFetch);\n  Promise.awaitAll(promises);\n}\n\nfunction moveScripts(data) {\n  const $ = Cheerio.load(data, {\n    decodeEntities: false\n  });\n  const heads = $('head script');\n  $('body').append(heads);\n  $('head').html($('head').html().replace(/(^[ \\t]*\\n)/gm, ''));\n\n  return $.html();\n}\n","// server/ssr_context.js\n// stolen from https://github.com/kadirahq/flow-router/blob/ssr/server/ssr_context.js\n\nexport default class SsrContext {\n  constructor() {\n    this._collections = {};\n  }\n\n  getCollection(collName) {\n    let collection = this._collections[collName];\n    if (!collection) {\n      const minimongo = Package.minimongo;\n      collection = this._collections[collName] = new minimongo.LocalCollection();\n    }\n\n    return collection;\n  }\n\n  addSubscription(name, params) {\n    const fastRenderContext = FastRender.frContext.get();\n    if (!fastRenderContext) {\n      throw new Error(\n        `Cannot add a subscription: ${name} without FastRender Context`\n      );\n    }\n\n\n    const data = fastRenderContext.subscribe(name, ...params);\n    this.addData(data);\n  }\n\n  addData(data) {\n    _.each(data, (collDataCollection, collectionName) => {\n      const collection = this.getCollection(collectionName);\n      collDataCollection.forEach((collData) => {\n        collData.forEach((item) => {\n          const existingDoc = collection.findOne(item._id);\n          if (existingDoc) {\n            const newDoc = { ...existingDoc, ...item };\n            delete newDoc._id;\n            collection.update(item._id, { $set: newDoc });\n          } else {\n            collection.insert(item);\n          }\n        });\n      });\n    });\n  }\n}\n","// server/ssr_data.js\n// stolen from https://github.com/kadirahq/flow-router/blob/ssr/server/ssr_data.js\n\nexport default function patchSubscribeData (ReactRouterSSR) {\n  const originalSubscribe = Meteor.subscribe;\n\n  Meteor.subscribe = function(pubName) {\n    const params = Array.prototype.slice.call(arguments, 1);\n\n    const ssrContext = ReactRouterSSR.ssrContext.get();\n    if (ssrContext) {\n      ReactRouterSSR.inSubscription.withValue(true, () => {\n        ssrContext.addSubscription(pubName, params);\n      });\n    }\n\n    if (originalSubscribe) {\n      originalSubscribe.apply(this, arguments);\n    }\n\n    return {\n      ready: () => true\n    };\n  };\n\n  const Mongo = Package.mongo.Mongo;\n  const originalFind = Mongo.Collection.prototype.find;\n\n  Mongo.Collection.prototype.find = function(selector = {}, options = {}) {\n    selector = selector || {};\n    const ssrContext = ReactRouterSSR.ssrContext.get();\n    if (ssrContext && !ReactRouterSSR.inSubscription.get()) {\n      const collName = this._name;\n\n      // this line is added just to make sure this works CollectionFS\n      if (typeof this._transform === 'function') {\n        options.transform = this._transform;\n      }\n\n      const collection = ssrContext.getCollection(collName);\n      const cursor = collection.find(selector, options);\n      return cursor;\n    }\n\n    return originalFind.call(this, selector, options);\n  };\n\n  // We must implement this. Otherwise, it'll call the origin prototype's\n  // find method\n  Mongo.Collection.prototype.findOne = function(selector, options) {\n    options = options || {};\n    options.limit = 1;\n    return this.find(selector, options).fetch()[0];\n  };\n\n  const originalAutorun = Tracker.autorun;\n\n  Tracker.autorun = (fn) => {\n    // if autorun is in the ssrContext, we need fake and run the callback\n    // in the same eventloop\n    if (ReactRouterSSR.ssrContext.get()) {\n      const c = { firstRun: true, stop: () => {} };\n      fn(c);\n      return c;\n    }\n\n    return originalAutorun.call(Tracker, fn);\n  };\n\n  // By default, Meteor[call,apply] also inherit SsrContext\n  // So, they can't access the full MongoDB dataset because of that\n  // Then, we need to remove the SsrContext within Method calls\n  ['call', 'apply'].forEach((methodName) => {\n    const original = Meteor[methodName];\n    Meteor[methodName] = (...args) => {\n      const response = ReactRouterSSR.ssrContext.withValue(null, () => {\n        return original.apply(this, args);\n      });\n\n      return response;\n    };\n  });\n\n  // This is not available in the server. But to make it work with SSR\n  // We need to have it.\n  Meteor.loggingIn = () => {\n    return false;\n  };\n}\n"]}